"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("react/jsx-runtime"),Xe=require("react"),I=require("../../node_modules/@dnd-kit/core/dist/core.esm.cjs"),q=require("../../node_modules/@dnd-kit/sortable/dist/sortable.esm.cjs"),Ae=require("../../node_modules/@dnd-kit/utilities/dist/utilities.esm.cjs"),m=require("../../lib/utils.cjs"),h=require("./table.cjs"),pe=require("../ui/checkbox.cjs"),Be=require("../ui/input.cjs"),Fe=require("../../icons/DownIcon.cjs"),Ve=require("../../icons/DragHandleIcon.cjs"),Ge=require("../../icons/RightIcon.cjs");function Je(l){const k=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const g in l)if(g!=="default"){const v=Object.getOwnPropertyDescriptor(l,g);Object.defineProperty(k,g,v.get?v:{enumerable:!0,get:()=>l[g]})}}return k.default=l,Object.freeze(k)}const a=Je(Xe);function Qe({value:l,onChange:k,onComplete:g,onCancel:v,error:u}){const x=a.useRef(null);a.useEffect(()=>{var p,K;(p=x.current)==null||p.focus(),(K=x.current)==null||K.select()},[]);const w=p=>{p.key==="Enter"?(p.preventDefault(),g()):p.key==="Escape"&&(p.preventDefault(),v())};return r.jsxs("div",{className:"flex flex-col gap-0.5",children:[r.jsx(Be.Input,{ref:x,value:String(l??""),onChange:p=>k(p.target.value),onKeyDown:w,error:!!u,className:"w-full min-w-[60px] px-2 text-xs"}),u&&r.jsx("span",{className:"text-[10px] text-destructive dark:text-red-400",children:u})]})}function Ue({id:l,children:k,className:g,style:v,disabled:u}){const{attributes:x,listeners:w,setNodeRef:p,transform:K,transition:c,isDragging:H}=q.useSortable({id:l,disabled:u}),F={...v,transform:Ae.CSS.Transform.toString(K),transition:c,opacity:H?.5:1,cursor:u?void 0:"grab"};return r.jsx("th",{ref:p,style:F,className:m.cn("group/drag h-9 pl-1.5 pr-1.5 py-1.5 text-left align-middle font-medium text-[#798698] dark:text-slate-300","bg-[#eaedf1] dark:bg-slate-800","[&:has([role=checkbox])]:pr-0","hover:bg-slate-200/70 dark:hover:bg-slate-700/70","transition-colors",H&&"z-50",g),...x,...w,children:r.jsxs("span",{className:"flex items-center gap-0.5",children:[r.jsx(Ve.DragHandleIcon,{size:16,className:"opacity-30 group-hover/drag:opacity-70 transition-opacity flex-shrink-0"}),k]})})}function Ye({columns:l,data:k,selectable:g=!1,selectedIds:v=[],onSelectionChange:u,sortState:x,onSortChange:w,onRowClick:p,onCellChange:K,expandable:c,emptyMessage:H="데이터가 없습니다.",className:F,rowClassName:V,maxHeight:xe,resizable:S=!1,columnWidths:M,onColumnResize:G,columnReorderable:T=!1,columnOrder:ye,onColumnReorder:J}){const[f,$]=a.useState(null),[be,_]=a.useState(null),P=a.useRef(null),re=a.useRef(null),[ke,ve]=a.useState((c==null?void 0:c.defaultExpandedRowIds)??[]),[Q,me]=a.useState({}),[D,ie]=a.useState(null),ne=a.useRef(0),ae=a.useRef(0),[je,we]=a.useState(()=>l.map(e=>e.accessorKey)),R=ye??je,Ee=a.useMemo(()=>T?R.map(e=>l.find(t=>t.accessorKey===e)).filter(e=>e!==void 0):l,[l,R,T]),Ke=I.useSensors(I.useSensor(I.PointerSensor,{activationConstraint:{distance:5}}),I.useSensor(I.KeyboardSensor,{coordinateGetter:q.sortableKeyboardCoordinates})),We=a.useCallback(e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return;const d=R.findIndex(E=>String(E)===t.id),s=R.findIndex(E=>String(E)===n.id);if(d===-1||s===-1)return;const y=q.arrayMove(R,d,s);J?J(y):we(y)},[R,J]),U=(c==null?void 0:c.expandedRowIds)??ke,ce=(c==null?void 0:c.onExpandedChange)??ve,Y=k.length>0&&v.length===k.length,Ne=v.length>0&&!Y,De=()=>{Y?u==null||u([]):u==null||u(k.map(e=>e.id))},Ie=e=>{v.includes(e)?u==null||u(v.filter(t=>t!==e)):u==null||u([...v,e])},Se=e=>{w&&((x==null?void 0:x.column)===e?x.direction==="asc"?w({column:e,direction:"desc"}):x.direction==="desc"?w({column:null,direction:null}):w({column:e,direction:"asc"}):w({column:e,direction:"asc"}))},Te=e=>(x==null?void 0:x.column)===e?x.direction:null,z=e=>{switch(e){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}},$e=(e,t,n)=>{$({rowId:e,columnKey:t}),_(n),P.current=n},Pe=(e,t)=>{const n=P.current;if(!f||n===null){$(null),_(null),P.current=null;return}if(e.validate){const d=e.validate(n,t);if(d!==!0){$({...f,error:d});return}}K&&K(f.rowId,f.columnKey,n),$(null),_(null),P.current=null},Z=a.useCallback(()=>{$(null),_(null),P.current=null},[]);a.useEffect(()=>{if(!f)return;const e=t=>{var s,y;const n=t.target;(s=re.current)!=null&&s.contains(n)||(y=n.closest)!=null&&y.call(n,"[data-radix-popper-content-wrapper]")||Z()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f,Z]);const Re=(e,t)=>(f==null?void 0:f.rowId)===e&&(f==null?void 0:f.columnKey)===t,ze=e=>c?c.rowExpandable?c.rowExpandable(e):!0:!1,oe=e=>U.includes(e),Ce=e=>{oe(e)?ce(U.filter(t=>t!==e)):ce([...U,e])},le=l.length+(g?1:0)+(c?1:0),de=a.useMemo(()=>{const e=i=>{const b=i.width??i.minWidth;return typeof b=="number"?b:parseInt(String(b)||"150",10)},t=l.filter(i=>i.sticky==="left"),n=l.filter(i=>i.sticky==="right"),y=(g?48:0)+(c?40:0),E=new Map;let o=y;for(const i of t)E.set(i.accessorKey,o),o+=e(i);const L=new Map;let N=0;for(let i=n.length-1;i>=0;i--){const b=n[i];L.set(b.accessorKey,N),N+=e(b)}const O=t.length>0?t[t.length-1].accessorKey:null,B=n.length>0?n[0].accessorKey:null;return(i,b,he)=>{if(!i.sticky)return{style:{},className:""};const Oe=i.accessorKey===O,qe=i.accessorKey===B,se=`${e(i)}px`,ge={position:"sticky",zIndex:b?20:10,width:se,minWidth:se,maxWidth:se};if(i.sticky==="left"){const Me=E.get(i.accessorKey)??0;return{style:{...ge,left:`${Me}px`},className:m.cn("transition-colors",b?"bg-[#eaedf1] dark:bg-slate-800":he?"bg-blue-50 dark:bg-blue-950/30":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",Oe&&"shadow-[2px_0_4px_rgba(0,0,0,0.08)]")}}const He=L.get(i.accessorKey)??0;return{style:{...ge,right:`${He}px`},className:m.cn("transition-colors",b?"bg-[#eaedf1] dark:bg-slate-800":he?"bg-blue-50 dark:bg-blue-950/30":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",qe&&"shadow-[-2px_0_4px_rgba(0,0,0,0.08)]")}}},[l,g,c]),C=l.some(e=>e.sticky==="left"),X=a.useCallback(e=>{const t=String(e.accessorKey);if(M&&t in M)return M[t];if(t in Q)return Q[t];if(e.width)return typeof e.width=="number"?e.width:parseInt(e.width,10)},[M,Q]),_e=a.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),ie(t.accessorKey),ne.current=e.clientX;const n=X(t)??150;ae.current=n},[X]),ee=a.useCallback(e=>{if(!D)return;const t=e.clientX-ne.current,n=Math.max(50,ae.current+t),d=String(D);G?G(D,n):me(s=>({...s,[d]:n}))},[D,G]),te=a.useCallback(()=>{ie(null)},[]);a.useEffect(()=>{if(D)return document.addEventListener("mousemove",ee),document.addEventListener("mouseup",te),document.body.style.userSelect="none",document.body.style.cursor="col-resize",()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te),document.body.style.userSelect="",document.body.style.cursor=""}},[D,ee,te]);const j=48,W=40,ue=e=>{const t=de(e,!0),n=o=>typeof o=="number"?`${o}px`:o,d={};if(!e.sticky){const o=S?X(e):void 0;o!==void 0?(d.width=`${o}px`,d.minWidth=`${o}px`):(e.width&&(d.width=n(e.width)),e.minWidth&&(d.minWidth=n(e.minWidth)))}const s={...d,...t.style},y=S&&r.jsx("div",{className:m.cn("absolute top-0 h-full w-[9px] cursor-col-resize opacity-0 hover:opacity-100 transition-opacity z-30",D===e.accessorKey&&"opacity-100"),style:{right:"-4px",background:"linear-gradient(to right, transparent, rgba(148,163,184,0.5) 50%, transparent)"},onMouseDown:o=>_e(o,e),onPointerDown:o=>o.stopPropagation(),onClick:o=>o.stopPropagation()});return T&&!e.sticky&&!e.sortable?r.jsxs(Ue,{id:String(e.accessorKey),style:s,className:m.cn(z(e.align),t.className,S&&"relative overflow-visible"),children:[e.header,y]},String(e.accessorKey)):e.sortable?r.jsxs(h.TableSortableHead,{sortDirection:Te(e.accessorKey),onSort:()=>Se(e.accessorKey),style:s,className:m.cn(z(e.align),t.className,S&&"relative overflow-visible"),children:[e.header,y]},String(e.accessorKey)):r.jsxs(h.TableHead,{style:s,className:m.cn(z(e.align),t.className,S&&"relative overflow-visible"),children:[e.header,y]},String(e.accessorKey))},A=T?Ee:l,Le=A.filter(e=>!e.sticky).map(e=>String(e.accessorKey)),fe=r.jsxs(h.Table,{className:F,maxHeight:xe,children:[r.jsx(h.TableHeader,{children:r.jsxs(h.TableRow,{children:[g&&r.jsx(h.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800",style:C?{position:"sticky",left:0,zIndex:20,width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`}:{width:`${j}px`},children:r.jsx(pe.Checkbox,{checked:Y,indeterminate:Ne,onCheckedChange:De,"aria-label":"전체 선택"})}),c&&r.jsx(h.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800",style:C?{position:"sticky",left:g?j:0,zIndex:20,width:`${W}px`,minWidth:`${W}px`,maxWidth:`${W}px`}:{width:`${W}px`},"aria-label":"확장",children:r.jsx("span",{className:"sr-only",children:"확장"})}),T?r.jsx(q.SortableContext,{items:Le,strategy:q.horizontalListSortingStrategy,children:A.map(ue)}):A.map(ue)]})}),r.jsx(h.TableBody,{children:k.length===0?r.jsx(h.TableRow,{children:r.jsx(h.TableCell,{colSpan:le,className:"h-24 text-center text-slate-500",children:H})}):k.map(e=>{const t=v.includes(e.id),n=ze(e),d=oe(e.id);return r.jsxs(a.Fragment,{children:[r.jsxs(h.TableRow,{"data-state":t?"selected":void 0,className:m.cn(p&&"cursor-pointer",V==null?void 0:V(e)),onClick:()=>p==null?void 0:p(e),children:[g&&r.jsx(h.TableCell,{onClick:s=>s.stopPropagation(),className:C?t?"transition-colors bg-blue-50 dark:bg-blue-950/30":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700":void 0,style:C?{position:"sticky",left:0,zIndex:10,width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`}:{width:`${j}px`},children:r.jsx(pe.Checkbox,{checked:t,onCheckedChange:()=>Ie(e.id),"aria-label":`행 ${e.id} 선택`})}),c&&r.jsx(h.TableCell,{className:m.cn("p-0",C&&(t?"transition-colors bg-blue-50 dark:bg-blue-950/30":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700")),style:C?{position:"sticky",left:g?j:0,zIndex:10,width:`${W}px`,minWidth:`${W}px`,maxWidth:`${W}px`}:{width:`${W}px`},onClick:s=>s.stopPropagation(),children:n&&r.jsx("button",{type:"button",onClick:()=>Ce(e.id),className:"flex h-9 w-10 items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors","aria-label":d?"행 접기":"행 펼치기","aria-expanded":d,children:d?r.jsx(Fe.DownIcon,{size:24}):r.jsx(Ge.RightIcon,{size:24})})}),A.map(s=>{const y=e[s.accessorKey],E=Re(e.id,s.accessorKey),o=de(s,!1,t),L=i=>typeof i=="number"?`${i}px`:i,N={};if(!s.sticky){const i=S?X(s):void 0;i!==void 0?(N.width=`${i}px`,N.minWidth=`${i}px`):(s.width&&(N.width=L(s.width)),s.minWidth&&(N.minWidth=L(s.minWidth)))}const O={...N,...o.style};if(E&&s.editable){const i=s.editComponent||Qe;return r.jsx(h.TableCell,{ref:re,className:m.cn(z(s.align),"p-1",o.className),style:O,onClick:b=>b.stopPropagation(),children:r.jsx(i,{value:be,onChange:b=>{_(b),P.current=b,f!=null&&f.error&&$({...f,error:void 0})},onComplete:()=>Pe(s,e),onCancel:Z,row:e,error:f==null?void 0:f.error})},String(s.accessorKey))}const B=s.cell?s.cell(y,e):String(y??"");return s.editable&&K?r.jsx(h.TableCell,{className:m.cn(z(s.align),"cursor-text hover:bg-blue-100 dark:hover:bg-blue-800",o.className),style:O,onClick:i=>{i.stopPropagation(),setTimeout(()=>{$e(e.id,s.accessorKey,y)},0)},children:B},String(s.accessorKey)):r.jsx(h.TableCell,{className:m.cn(z(s.align),o.className),style:O,children:B},String(s.accessorKey))})]}),c&&d&&r.jsx(h.TableRow,{className:"bg-white dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800/50",children:r.jsx(h.TableCell,{colSpan:le,className:"p-4",children:c.expandedRowRender(e)})})]},e.id)})})]});return T?r.jsx(I.DndContext,{sensors:Ke,collisionDetection:I.closestCenter,onDragEnd:We,children:fe}):fe}exports.DataTable=Ye;
//# sourceMappingURL=data-table.cjs.map
