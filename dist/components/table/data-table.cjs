"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),xe=require("react"),m=require("../../lib/utils.cjs"),l=require("./table.cjs"),J=require("../ui/checkbox.cjs"),pe=require("../ui/input.cjs"),be=require("../../icons/DownIcon.cjs"),ye=require("../../icons/RightIcon.cjs");function ke(d){const p=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(d){for(const u in d)if(u!=="default"){const b=Object.getOwnPropertyDescriptor(d,u);Object.defineProperty(p,u,b.get?b:{enumerable:!0,get:()=>d[u]})}}return p.default=d,Object.freeze(p)}const y=ke(xe);function ve({value:d,onChange:p,onComplete:u,onCancel:b,error:o}){const f=y.useRef(null);y.useEffect(()=>{var h,N;(h=f.current)==null||h.focus(),(N=f.current)==null||N.select()},[]);const T=h=>{h.key==="Enter"?(h.preventDefault(),u()):h.key==="Escape"&&(h.preventDefault(),b())};return t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx(pe.Input,{ref:f,value:String(d??""),onChange:h=>p(h.target.value),onKeyDown:T,error:!!o,className:"w-full min-w-[60px] px-2 text-xs"}),o&&t.jsx("span",{className:"text-[10px] text-destructive dark:text-red-400",children:o})]})}function je({columns:d,data:p,selectable:u=!1,selectedIds:b=[],onSelectionChange:o,sortState:f,onSortChange:T,onRowClick:h,onCellChange:N,expandable:c,emptyMessage:Q="데이터가 없습니다.",className:U,rowClassName:O,maxHeight:Y}){const[a,w]=y.useState(null),[Z,D]=y.useState(null),K=y.useRef(null),M=y.useRef(null),[C,S]=y.useState((c==null?void 0:c.defaultExpandedRowIds)??[]),q=(c==null?void 0:c.expandedRowIds)??C,A=(c==null?void 0:c.onExpandedChange)??S,z=p.length>0&&b.length===p.length,ee=b.length>0&&!z,te=()=>{z?o==null||o([]):o==null||o(p.map(e=>e.id))},se=e=>{b.includes(e)?o==null||o(b.filter(r=>r!==e)):o==null||o([...b,e])},re=e=>{T&&((f==null?void 0:f.column)===e?f.direction==="asc"?T({column:e,direction:"desc"}):f.direction==="desc"?T({column:null,direction:null}):T({column:e,direction:"asc"}):T({column:e,direction:"asc"}))},ie=e=>(f==null?void 0:f.column)===e?f.direction:null,I=e=>{switch(e){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}},ne=(e,r,i)=>{w({rowId:e,columnKey:r}),D(i),K.current=i},ce=(e,r)=>{const i=K.current;if(!a||i===null){w(null),D(null),K.current=null;return}if(e.validate){const g=e.validate(i,r);if(g!==!0){w({...a,error:g});return}}N&&N(a.rowId,a.columnKey,i),w(null),D(null),K.current=null},L=y.useCallback(()=>{w(null),D(null),K.current=null},[]);y.useEffect(()=>{if(!a)return;const e=r=>{var s,x;const i=r.target;(s=M.current)!=null&&s.contains(i)||(x=i.closest)!=null&&x.call(i,"[data-radix-popper-content-wrapper]")||L()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a,L]);const ae=(e,r)=>(a==null?void 0:a.rowId)===e&&(a==null?void 0:a.columnKey)===r,le=e=>c?c.rowExpandable?c.rowExpandable(e):!0:!1,B=e=>q.includes(e),oe=e=>{B(e)?A(q.filter(r=>r!==e)):A([...q,e])},F=d.length+(u?1:0)+(c?1:0),V=y.useMemo(()=>{const e=n=>{const v=n.width??n.minWidth;return typeof v=="number"?v:parseInt(String(v)||"150",10)},r=d.filter(n=>n.sticky==="left"),i=d.filter(n=>n.sticky==="right"),x=(u?48:0)+(c?40:0),_=new Map;let j=x;for(const n of r)_.set(n.accessorKey,j),j+=e(n);const P=new Map;let W=0;for(let n=i.length-1;n>=0;n--){const v=i[n];P.set(v.accessorKey,W),W+=e(v)}const $=r.length>0?r[r.length-1].accessorKey:null,de=i.length>0?i[0].accessorKey:null;return(n,v,X)=>{if(!n.sticky)return{style:{},className:""};const ue=n.accessorKey===$,he=n.accessorKey===de,H=`${e(n)}px`,G={position:"sticky",zIndex:v?20:10,width:H,minWidth:H,maxWidth:H};if(n.sticky==="left"){const ge=_.get(n.accessorKey)??0;return{style:{...G,left:`${ge}px`},className:m.cn("transition-colors",v?"bg-[#eaedf1] dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700":X?"bg-blue-50 dark:bg-blue-900":"bg-slate-50 dark:bg-slate-900 group-hover:bg-slate-100 dark:group-hover:bg-slate-800",ue&&"shadow-[2px_0_4px_rgba(0,0,0,0.08)]")}}const fe=P.get(n.accessorKey)??0;return{style:{...G,right:`${fe}px`},className:m.cn("transition-colors",v?"bg-[#eaedf1] dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700":X?"bg-blue-50 dark:bg-blue-900":"bg-slate-50 dark:bg-slate-900 group-hover:bg-slate-100 dark:group-hover:bg-slate-800",he&&"shadow-[-2px_0_4px_rgba(0,0,0,0.08)]")}}},[d,u,c]),R=d.some(e=>e.sticky==="left"),k=48,E=40;return t.jsxs(l.Table,{className:U,maxHeight:Y,children:[t.jsx(l.TableHeader,{children:t.jsxs(l.TableRow,{children:[u&&t.jsx(l.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700",style:R?{position:"sticky",left:0,zIndex:20,width:`${k}px`,minWidth:`${k}px`,maxWidth:`${k}px`}:{width:`${k}px`},children:t.jsx(J.Checkbox,{checked:z,indeterminate:ee,onCheckedChange:te,"aria-label":"전체 선택"})}),c&&t.jsx(l.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700",style:R?{position:"sticky",left:u?k:0,zIndex:20,width:`${E}px`,minWidth:`${E}px`,maxWidth:`${E}px`}:{width:`${E}px`},"aria-label":"확장",children:t.jsx("span",{className:"sr-only",children:"확장"})}),d.map(e=>{const r=V(e,!0),i=x=>typeof x=="number"?`${x}px`:x,g={};e.sticky||(e.width&&(g.width=i(e.width)),e.minWidth&&(g.minWidth=i(e.minWidth)));const s={...g,...r.style};return e.sortable?t.jsx(l.TableSortableHead,{sortDirection:ie(e.accessorKey),onSort:()=>re(e.accessorKey),style:s,className:m.cn(I(e.align),r.className),children:e.header},String(e.accessorKey)):t.jsx(l.TableHead,{style:s,className:m.cn(I(e.align),r.className),children:e.header},String(e.accessorKey))})]})}),t.jsx(l.TableBody,{children:p.length===0?t.jsx(l.TableRow,{children:t.jsx(l.TableCell,{colSpan:F,className:"h-24 text-center text-slate-500",children:Q})}):p.map(e=>{const r=b.includes(e.id),i=le(e),g=B(e.id);return t.jsxs(y.Fragment,{children:[t.jsxs(l.TableRow,{"data-state":r?"selected":void 0,className:m.cn(h&&"cursor-pointer",O==null?void 0:O(e)),onClick:()=>h==null?void 0:h(e),children:[u&&t.jsx(l.TableCell,{onClick:s=>s.stopPropagation(),className:R?r?"transition-colors bg-blue-50 dark:bg-blue-900":"transition-colors bg-slate-50 dark:bg-slate-900 group-hover:bg-slate-100 dark:group-hover:bg-slate-800":void 0,style:R?{position:"sticky",left:0,zIndex:10,width:`${k}px`,minWidth:`${k}px`,maxWidth:`${k}px`}:{width:`${k}px`},children:t.jsx(J.Checkbox,{checked:r,onCheckedChange:()=>se(e.id),"aria-label":`행 ${e.id} 선택`})}),c&&t.jsx(l.TableCell,{className:m.cn("p-0",R&&(r?"transition-colors bg-blue-50 dark:bg-blue-900":"transition-colors bg-slate-50 dark:bg-slate-900 group-hover:bg-slate-100 dark:group-hover:bg-slate-800")),style:R?{position:"sticky",left:u?k:0,zIndex:10,width:`${E}px`,minWidth:`${E}px`,maxWidth:`${E}px`}:{width:`${E}px`},onClick:s=>s.stopPropagation(),children:i&&t.jsx("button",{type:"button",onClick:()=>oe(e.id),className:"flex h-9 w-10 items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors","aria-label":g?"행 접기":"행 펼치기","aria-expanded":g,children:g?t.jsx(be.DownIcon,{size:24}):t.jsx(ye.RightIcon,{size:24})})}),d.map(s=>{const x=e[s.accessorKey],_=ae(e.id,s.accessorKey),j=V(s,!1,r);if(_&&s.editable){const W=s.editComponent||ve;return t.jsx(l.TableCell,{ref:M,className:m.cn(I(s.align),"p-1",j.className),style:j.style,onClick:$=>$.stopPropagation(),children:t.jsx(W,{value:Z,onChange:$=>{D($),K.current=$,a!=null&&a.error&&w({...a,error:void 0})},onComplete:()=>ce(s,e),onCancel:L,row:e,error:a==null?void 0:a.error})},String(s.accessorKey))}const P=s.cell?s.cell(x,e):String(x??"");return s.editable&&N?t.jsx(l.TableCell,{className:m.cn(I(s.align),"cursor-text hover:bg-blue-100 dark:hover:bg-blue-800",j.className),style:j.style,onClick:W=>{W.stopPropagation(),setTimeout(()=>{ne(e.id,s.accessorKey,x)},0)},children:P},String(s.accessorKey)):t.jsx(l.TableCell,{className:m.cn(I(s.align),j.className),style:j.style,children:P},String(s.accessorKey))})]}),c&&g&&t.jsx(l.TableRow,{className:"bg-white dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800/50",children:t.jsx(l.TableCell,{colSpan:F,className:"p-4",children:c.expandedRowRender(e)})})]},e.id)})})]})}exports.DataTable=je;
//# sourceMappingURL=data-table.cjs.map
