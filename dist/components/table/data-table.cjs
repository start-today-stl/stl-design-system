"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react/jsx-runtime"),gt=require("react"),v=require("../../lib/utils.cjs"),l=require("./table.cjs"),J=require("../ui/checkbox.cjs"),pt=require("../ui/input.cjs"),bt=require("../../icons/DownIcon.cjs"),yt=require("../../icons/RightIcon.cjs");function kt(d){const p=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(d){for(const u in d)if(u!=="default"){const b=Object.getOwnPropertyDescriptor(d,u);Object.defineProperty(p,u,b.get?b:{enumerable:!0,get:()=>d[u]})}}return p.default=d,Object.freeze(p)}const y=kt(gt);function jt({value:d,onChange:p,onComplete:u,onCancel:b,error:o}){const h=y.useRef(null);y.useEffect(()=>{var f,N;(f=h.current)==null||f.focus(),(N=h.current)==null||N.select()},[]);const T=f=>{f.key==="Enter"?(f.preventDefault(),u()):f.key==="Escape"&&(f.preventDefault(),b())};return e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx(pt.Input,{ref:h,value:String(d??""),onChange:f=>p(f.target.value),onKeyDown:T,error:!!o,className:"w-full min-w-[60px] px-2 text-xs"}),o&&e.jsx("span",{className:"text-[10px] text-destructive dark:text-red-400",children:o})]})}function mt({columns:d,data:p,selectable:u=!1,selectedIds:b=[],onSelectionChange:o,sortState:h,onSortChange:T,onRowClick:f,onCellChange:N,expandable:c,emptyMessage:Q="데이터가 없습니다.",className:U,rowClassName:O,maxHeight:Y}){const[a,w]=y.useState(null),[Z,D]=y.useState(null),K=y.useRef(null),M=y.useRef(null),[C,S]=y.useState((c==null?void 0:c.defaultExpandedRowIds)??[]),q=(c==null?void 0:c.expandedRowIds)??C,A=(c==null?void 0:c.onExpandedChange)??S,z=p.length>0&&b.length===p.length,tt=b.length>0&&!z,et=()=>{z?o==null||o([]):o==null||o(p.map(t=>t.id))},st=t=>{b.includes(t)?o==null||o(b.filter(r=>r!==t)):o==null||o([...b,t])},rt=t=>{T&&((h==null?void 0:h.column)===t?h.direction==="asc"?T({column:t,direction:"desc"}):h.direction==="desc"?T({column:null,direction:null}):T({column:t,direction:"asc"}):T({column:t,direction:"asc"}))},it=t=>(h==null?void 0:h.column)===t?h.direction:null,I=t=>{switch(t){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}},nt=(t,r,i)=>{w({rowId:t,columnKey:r}),D(i),K.current=i},ct=(t,r)=>{const i=K.current;if(!a||i===null){w(null),D(null),K.current=null;return}if(t.validate){const x=t.validate(i,r);if(x!==!0){w({...a,error:x});return}}N&&N(a.rowId,a.columnKey,i),w(null),D(null),K.current=null},L=y.useCallback(()=>{w(null),D(null),K.current=null},[]);y.useEffect(()=>{if(!a)return;const t=r=>{var s,g;const i=r.target;(s=M.current)!=null&&s.contains(i)||(g=i.closest)!=null&&g.call(i,"[data-radix-popper-content-wrapper]")||L()};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[a,L]);const at=(t,r)=>(a==null?void 0:a.rowId)===t&&(a==null?void 0:a.columnKey)===r,lt=t=>c?c.rowExpandable?c.rowExpandable(t):!0:!1,B=t=>q.includes(t),ot=t=>{B(t)?A(q.filter(r=>r!==t)):A([...q,t])},F=d.length+(u?1:0)+(c?1:0),V=y.useMemo(()=>{const t=n=>{const j=n.width??n.minWidth;return typeof j=="number"?j:parseInt(String(j)||"150",10)},r=d.filter(n=>n.sticky==="left"),i=d.filter(n=>n.sticky==="right"),g=(u?48:0)+(c?40:0),_=new Map;let m=g;for(const n of r)_.set(n.accessorKey,m),m+=t(n);const P=new Map;let W=0;for(let n=i.length-1;n>=0;n--){const j=i[n];P.set(j.accessorKey,W),W+=t(j)}const $=r.length>0?r[r.length-1].accessorKey:null,dt=i.length>0?i[0].accessorKey:null;return(n,j,X)=>{if(!n.sticky)return{style:{},className:""};const ut=n.accessorKey===$,ft=n.accessorKey===dt,H=`${t(n)}px`,G={position:"sticky",zIndex:j?20:10,width:H,minWidth:H,maxWidth:H};if(n.sticky==="left"){const xt=_.get(n.accessorKey)??0;return{style:{...G,left:`${xt}px`},className:v.cn("transition-colors",j?"bg-[#eaedf1] dark:bg-slate-800":X?"bg-blue-50 dark:bg-blue-900":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",ut&&"shadow-[2px_0_4px_rgba(0,0,0,0.08)]")}}const ht=P.get(n.accessorKey)??0;return{style:{...G,right:`${ht}px`},className:v.cn("transition-colors",j?"bg-[#eaedf1] dark:bg-slate-800":X?"bg-blue-50 dark:bg-blue-900":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",ft&&"shadow-[-2px_0_4px_rgba(0,0,0,0.08)]")}}},[d,u,c]),R=d.some(t=>t.sticky==="left"),k=48,E=40;return e.jsxs(l.Table,{className:U,maxHeight:Y,children:[e.jsx(l.TableHeader,{children:e.jsxs(l.TableRow,{children:[u&&e.jsx(l.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800",style:R?{position:"sticky",left:0,zIndex:20,width:`${k}px`,minWidth:`${k}px`,maxWidth:`${k}px`}:{width:`${k}px`},children:e.jsx(J.Checkbox,{checked:z,indeterminate:tt,onCheckedChange:et,"aria-label":"전체 선택"})}),c&&e.jsx(l.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800",style:R?{position:"sticky",left:u?k:0,zIndex:20,width:`${E}px`,minWidth:`${E}px`,maxWidth:`${E}px`}:{width:`${E}px`},"aria-label":"확장",children:e.jsx("span",{className:"sr-only",children:"확장"})}),d.map(t=>{const r=V(t,!0),i=g=>typeof g=="number"?`${g}px`:g,x={};t.sticky||(t.width&&(x.width=i(t.width)),t.minWidth&&(x.minWidth=i(t.minWidth)));const s={...x,...r.style};return t.sortable?e.jsx(l.TableSortableHead,{sortDirection:it(t.accessorKey),onSort:()=>rt(t.accessorKey),style:s,className:v.cn(I(t.align),r.className),children:t.header},String(t.accessorKey)):e.jsx(l.TableHead,{style:s,className:v.cn(I(t.align),r.className),children:t.header},String(t.accessorKey))})]})}),e.jsx(l.TableBody,{children:p.length===0?e.jsx(l.TableRow,{children:e.jsx(l.TableCell,{colSpan:F,className:"h-24 text-center text-slate-500",children:Q})}):p.map(t=>{const r=b.includes(t.id),i=lt(t),x=B(t.id);return e.jsxs(y.Fragment,{children:[e.jsxs(l.TableRow,{"data-state":r?"selected":void 0,className:v.cn(f&&"cursor-pointer",O==null?void 0:O(t)),onClick:()=>f==null?void 0:f(t),children:[u&&e.jsx(l.TableCell,{onClick:s=>s.stopPropagation(),className:R?r?"transition-colors bg-blue-50 dark:bg-blue-900":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700":void 0,style:R?{position:"sticky",left:0,zIndex:10,width:`${k}px`,minWidth:`${k}px`,maxWidth:`${k}px`}:{width:`${k}px`},children:e.jsx(J.Checkbox,{checked:r,onCheckedChange:()=>st(t.id),"aria-label":`행 ${t.id} 선택`})}),c&&e.jsx(l.TableCell,{className:v.cn("p-0",R&&(r?"transition-colors bg-blue-50 dark:bg-blue-900":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700")),style:R?{position:"sticky",left:u?k:0,zIndex:10,width:`${E}px`,minWidth:`${E}px`,maxWidth:`${E}px`}:{width:`${E}px`},onClick:s=>s.stopPropagation(),children:i&&e.jsx("button",{type:"button",onClick:()=>ot(t.id),className:"flex h-9 w-10 items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors","aria-label":x?"행 접기":"행 펼치기","aria-expanded":x,children:x?e.jsx(bt.DownIcon,{size:24}):e.jsx(yt.RightIcon,{size:24})})}),d.map(s=>{const g=t[s.accessorKey],_=at(t.id,s.accessorKey),m=V(s,!1,r);if(_&&s.editable){const W=s.editComponent||jt;return e.jsx(l.TableCell,{ref:M,className:v.cn(I(s.align),"p-1",m.className),style:m.style,onClick:$=>$.stopPropagation(),children:e.jsx(W,{value:Z,onChange:$=>{D($),K.current=$,a!=null&&a.error&&w({...a,error:void 0})},onComplete:()=>ct(s,t),onCancel:L,row:t,error:a==null?void 0:a.error})},String(s.accessorKey))}const P=s.cell?s.cell(g,t):String(g??"");return s.editable&&N?e.jsx(l.TableCell,{className:v.cn(I(s.align),"cursor-text hover:bg-blue-100 dark:hover:bg-blue-800",m.className),style:m.style,onClick:W=>{W.stopPropagation(),setTimeout(()=>{nt(t.id,s.accessorKey,g)},0)},children:P},String(s.accessorKey)):e.jsx(l.TableCell,{className:v.cn(I(s.align),m.className),style:m.style,children:P},String(s.accessorKey))})]}),c&&x&&e.jsx(l.TableRow,{className:"bg-white dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800/50",children:e.jsx(l.TableCell,{colSpan:F,className:"p-4",children:c.expandedRowRender(t)})})]},t.id)})})]})}exports.DataTable=mt;
//# sourceMappingURL=data-table.cjs.map
