"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const r=require("react/jsx-runtime"),Xe=require("react"),D=require("../../node_modules/@dnd-kit/core/dist/core.esm.cjs"),q=require("../../node_modules/@dnd-kit/sortable/dist/sortable.esm.cjs"),Ae=require("../../node_modules/@dnd-kit/utilities/dist/utilities.esm.cjs"),w=require("../../lib/utils.cjs"),f=require("./table.cjs"),ge=require("../ui/checkbox.cjs"),Be=require("../ui/input.cjs"),Fe=require("../../icons/DownIcon.cjs"),Ve=require("../../icons/DragHandleIcon.cjs"),Ge=require("../../icons/RightIcon.cjs");function Je(l){const m=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const p in l)if(p!=="default"){const v=Object.getOwnPropertyDescriptor(l,p);Object.defineProperty(m,p,v.get?v:{enumerable:!0,get:()=>l[p]})}}return m.default=l,Object.freeze(m)}const a=Je(Xe);function Qe({value:l,onChange:m,onComplete:p,onCancel:v,error:u}){const x=a.useRef(null);a.useEffect(()=>{var g,$;(g=x.current)==null||g.focus(),($=x.current)==null||$.select()},[]);const W=g=>{g.key==="Enter"?(g.preventDefault(),p()):g.key==="Escape"&&(g.preventDefault(),v())};return r.jsxs("div",{className:"flex flex-col gap-0.5",children:[r.jsx(Be.Input,{ref:x,value:String(l??""),onChange:g=>m(g.target.value),onKeyDown:W,error:!!u,className:"w-full min-w-[60px] px-2 text-xs"}),u&&r.jsx("span",{className:"text-[10px] text-destructive dark:text-red-400",children:u})]})}function Ue({id:l,children:m,className:p,style:v,disabled:u}){const{attributes:x,listeners:W,setNodeRef:g,transform:$,transition:c,isDragging:H}=q.useSortable({id:l,disabled:u}),F={...v,transform:Ae.CSS.Transform.toString($),transition:c,opacity:H?.5:1,cursor:u?void 0:"grab"};return r.jsx("th",{ref:g,style:F,className:w.cn("group/drag h-9 pl-1.5 pr-1.5 py-1.5 text-left align-middle font-medium text-[#798698] dark:text-slate-300","bg-[#eaedf1] dark:bg-slate-800","[&:has([role=checkbox])]:pr-0","hover:bg-slate-200/70 dark:hover:bg-slate-700/70","transition-colors",H&&"z-50",p),...x,...W,children:r.jsxs("span",{className:"flex items-center gap-0.5",children:[r.jsx(Ve.DragHandleIcon,{size:16,className:"opacity-30 group-hover/drag:opacity-70 transition-opacity flex-shrink-0"}),m]})})}function Ye({columns:l,data:m,selectable:p=!1,selectedIds:v=[],onSelectionChange:u,sortState:x,onSortChange:W,onRowClick:g,onCellChange:$,expandable:c,emptyMessage:H="데이터가 없습니다.",className:F,rowClassName:V,maxHeight:xe,resizable:I=!1,columnWidths:M,onColumnResize:G,columnReorderable:S=!1,columnOrder:ye,onColumnReorder:J}){const[h,T]=a.useState(null),[be,_]=a.useState(null),P=a.useRef(null),re=a.useRef(null),[ke,me]=a.useState((c==null?void 0:c.defaultExpandedRowIds)??[]),[Q,ve]=a.useState({}),[N,ie]=a.useState(null),ne=a.useRef(0),ae=a.useRef(0),[je,we]=a.useState(()=>l.map(e=>e.accessorKey)),R=ye??je,We=a.useMemo(()=>S?R.map(e=>l.find(t=>t.accessorKey===e)).filter(e=>e!==void 0):l,[l,R,S]),Ee=D.useSensors(D.useSensor(D.PointerSensor,{activationConstraint:{distance:5}}),D.useSensor(D.KeyboardSensor,{coordinateGetter:q.sortableKeyboardCoordinates})),$e=a.useCallback(e=>{const{active:t,over:n}=e;if(!n||t.id===n.id)return;const d=R.findIndex(E=>String(E)===t.id),s=R.findIndex(E=>String(E)===n.id);if(d===-1||s===-1)return;const b=q.arrayMove(R,d,s);J?J(b):we(b)},[R,J]),U=(c==null?void 0:c.expandedRowIds)??ke,ce=(c==null?void 0:c.onExpandedChange)??me,Y=m.length>0&&v.length===m.length,Ke=v.length>0&&!Y,Ne=()=>{Y?u==null||u([]):u==null||u(m.map(e=>e.id))},De=e=>{v.includes(e)?u==null||u(v.filter(t=>t!==e)):u==null||u([...v,e])},Ie=e=>{W&&((x==null?void 0:x.column)===e?x.direction==="asc"?W({column:e,direction:"desc"}):x.direction==="desc"?W({column:null,direction:null}):W({column:e,direction:"asc"}):W({column:e,direction:"asc"}))},Se=e=>(x==null?void 0:x.column)===e?x.direction:null,z=e=>{switch(e){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}},Te=(e,t,n)=>{T({rowId:e,columnKey:t}),_(n),P.current=n},Pe=(e,t)=>{const n=P.current;if(!h||n===null){T(null),_(null),P.current=null;return}if(e.validate){const d=e.validate(n,t);if(d!==!0){T({...h,error:d});return}}$&&$(h.rowId,h.columnKey,n),T(null),_(null),P.current=null},Z=a.useCallback(()=>{T(null),_(null),P.current=null},[]);a.useEffect(()=>{if(!h)return;const e=t=>{var s,b;const n=t.target;(s=re.current)!=null&&s.contains(n)||(b=n.closest)!=null&&b.call(n,"[data-radix-popper-content-wrapper]")||Z()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[h,Z]);const Re=(e,t)=>(h==null?void 0:h.rowId)===e&&(h==null?void 0:h.columnKey)===t,ze=e=>c?c.rowExpandable?c.rowExpandable(e):!0:!1,oe=e=>U.includes(e),Ce=e=>{oe(e)?ce(U.filter(t=>t!==e)):ce([...U,e])},le=l.length+(p?1:0)+(c?1:0),y=40,j=40,de=a.useMemo(()=>{const e=i=>{const k=i.width??i.minWidth;return typeof k=="number"?k:parseInt(String(k)||"150",10)},t=l.filter(i=>i.sticky==="left"),n=l.filter(i=>i.sticky==="right"),b=(p?y:0)+(c?j:0),E=new Map;let o=b;for(const i of t)E.set(i.accessorKey,o),o+=e(i);const L=new Map;let K=0;for(let i=n.length-1;i>=0;i--){const k=n[i];L.set(k.accessorKey,K),K+=e(k)}const O=t.length>0?t[t.length-1].accessorKey:null,B=n.length>0?n[0].accessorKey:null;return(i,k,fe)=>{if(!i.sticky)return{style:{},className:""};const Oe=i.accessorKey===O,qe=i.accessorKey===B,se=`${e(i)}px`,pe={position:"sticky",zIndex:k?20:10,width:se,minWidth:se,maxWidth:se};if(i.sticky==="left"){const Me=E.get(i.accessorKey)??0;return{style:{...pe,left:`${Me}px`},className:w.cn("transition-colors",k?"bg-[#eaedf1] dark:bg-slate-800":fe?"bg-blue-50 dark:bg-blue-950/30":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",Oe&&"shadow-[2px_0_4px_rgba(0,0,0,0.08)]")}}const He=L.get(i.accessorKey)??0;return{style:{...pe,right:`${He}px`},className:w.cn("transition-colors",k?"bg-[#eaedf1] dark:bg-slate-800":fe?"bg-blue-50 dark:bg-blue-950/30":"bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700",qe&&"shadow-[-2px_0_4px_rgba(0,0,0,0.08)]")}}},[l,p,c]),C=l.some(e=>e.sticky==="left"),X=a.useCallback(e=>{const t=String(e.accessorKey);if(M&&t in M)return M[t];if(t in Q)return Q[t];if(e.width)return typeof e.width=="number"?e.width:parseInt(e.width,10)},[M,Q]),_e=a.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),ie(t.accessorKey),ne.current=e.clientX;const n=X(t)??150;ae.current=n},[X]),ee=a.useCallback(e=>{if(!N)return;const t=e.clientX-ne.current,n=Math.max(50,ae.current+t),d=String(N);G?G(N,n):ve(s=>({...s,[d]:n}))},[N,G]),te=a.useCallback(()=>{ie(null)},[]);a.useEffect(()=>{if(N)return document.addEventListener("mousemove",ee),document.addEventListener("mouseup",te),document.body.style.userSelect="none",document.body.style.cursor="col-resize",()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te),document.body.style.userSelect="",document.body.style.cursor=""}},[N,ee,te]);const ue=e=>{const t=de(e,!0),n=o=>typeof o=="number"?`${o}px`:o,d={};if(!e.sticky){const o=I?X(e):void 0;o!==void 0?(d.width=`${o}px`,d.minWidth=`${o}px`):(e.width&&(d.width=n(e.width)),e.minWidth&&(d.minWidth=n(e.minWidth)))}const s={...d,...t.style},b=I&&r.jsx("div",{className:w.cn("absolute top-0 h-full w-[9px] cursor-col-resize opacity-0 hover:opacity-100 transition-opacity z-30",N===e.accessorKey&&"opacity-100"),style:{right:"-4px",background:"linear-gradient(to right, transparent, rgba(148,163,184,0.5) 50%, transparent)"},onMouseDown:o=>_e(o,e),onPointerDown:o=>o.stopPropagation(),onClick:o=>o.stopPropagation()});return S&&!e.sticky&&!e.sortable?r.jsxs(Ue,{id:String(e.accessorKey),style:s,className:w.cn(z(e.align),t.className,I&&"relative overflow-visible"),children:[e.header,b]},String(e.accessorKey)):e.sortable?r.jsxs(f.TableSortableHead,{sortDirection:Se(e.accessorKey),onSort:()=>Ie(e.accessorKey),style:s,className:w.cn(z(e.align),t.className,I&&"relative overflow-visible"),children:[e.header,b]},String(e.accessorKey)):r.jsxs(f.TableHead,{style:s,className:w.cn(z(e.align),t.className,I&&"relative overflow-visible"),children:[e.header,b]},String(e.accessorKey))},A=S?We:l,Le=A.filter(e=>!e.sticky).map(e=>String(e.accessorKey)),he=r.jsxs(f.Table,{className:F,maxHeight:xe,children:[r.jsx(f.TableHeader,{children:r.jsxs(f.TableRow,{children:[p&&r.jsx(f.TableHead,{className:"!p-0 bg-[#eaedf1] dark:bg-slate-800",style:C?{position:"sticky",left:0,zIndex:20,width:`${y}px`,minWidth:`${y}px`,maxWidth:`${y}px`}:{width:`${y}px`,minWidth:`${y}px`,maxWidth:`${y}px`},children:r.jsx("div",{className:"flex items-center justify-center h-9",children:r.jsx(ge.Checkbox,{checked:Y,indeterminate:Ke,onCheckedChange:Ne,"aria-label":"전체 선택"})})}),c&&r.jsx(f.TableHead,{className:"bg-[#eaedf1] dark:bg-slate-800",style:C?{position:"sticky",left:p?y:0,zIndex:20,width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`}:{width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`},"aria-label":"확장",children:r.jsx("span",{className:"sr-only",children:"확장"})}),S?r.jsx(q.SortableContext,{items:Le,strategy:q.horizontalListSortingStrategy,children:A.map(ue)}):A.map(ue)]})}),r.jsx(f.TableBody,{children:m.length===0?r.jsx(f.TableRow,{children:r.jsx(f.TableCell,{colSpan:le,className:"h-24 text-center text-slate-500",children:H})}):m.map(e=>{const t=v.includes(e.id),n=ze(e),d=oe(e.id);return r.jsxs(a.Fragment,{children:[r.jsxs(f.TableRow,{"data-state":t?"selected":void 0,className:w.cn(g&&"cursor-pointer",V==null?void 0:V(e)),onClick:()=>g==null?void 0:g(e),children:[p&&r.jsx(f.TableCell,{onClick:s=>s.stopPropagation(),className:w.cn("!p-0",C&&(t?"transition-colors bg-blue-50 dark:bg-blue-950/30":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700")),style:C?{position:"sticky",left:0,zIndex:10,width:`${y}px`,minWidth:`${y}px`,maxWidth:`${y}px`}:{width:`${y}px`,minWidth:`${y}px`,maxWidth:`${y}px`},children:r.jsx("div",{className:"flex items-center justify-center h-9",children:r.jsx(ge.Checkbox,{checked:t,onCheckedChange:()=>De(e.id),"aria-label":`행 ${e.id} 선택`})})}),c&&r.jsx(f.TableCell,{className:w.cn("p-0",C&&(t?"transition-colors bg-blue-50 dark:bg-blue-950/30":"transition-colors bg-slate-50 dark:bg-slate-800 group-hover:bg-slate-100 dark:group-hover:bg-slate-700")),style:C?{position:"sticky",left:p?y:0,zIndex:10,width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`}:{width:`${j}px`,minWidth:`${j}px`,maxWidth:`${j}px`},onClick:s=>s.stopPropagation(),children:n&&r.jsx("button",{type:"button",onClick:()=>Ce(e.id),className:"flex h-9 w-10 items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors","aria-label":d?"행 접기":"행 펼치기","aria-expanded":d,children:d?r.jsx(Fe.DownIcon,{size:24}):r.jsx(Ge.RightIcon,{size:24})})}),A.map(s=>{const b=e[s.accessorKey],E=Re(e.id,s.accessorKey),o=de(s,!1,t),L=i=>typeof i=="number"?`${i}px`:i,K={};if(!s.sticky){const i=I?X(s):void 0;i!==void 0?(K.width=`${i}px`,K.minWidth=`${i}px`):(s.width&&(K.width=L(s.width)),s.minWidth&&(K.minWidth=L(s.minWidth)))}const O={...K,...o.style};if(E&&s.editable){const i=s.editComponent||Qe;return r.jsx(f.TableCell,{ref:re,className:w.cn(z(s.align),"p-1",o.className),style:O,onClick:k=>k.stopPropagation(),children:r.jsx(i,{value:be,onChange:k=>{_(k),P.current=k,h!=null&&h.error&&T({...h,error:void 0})},onComplete:()=>Pe(s,e),onCancel:Z,row:e,error:h==null?void 0:h.error})},String(s.accessorKey))}const B=s.cell?s.cell(b,e):String(b??"");return s.editable&&$?r.jsx(f.TableCell,{className:w.cn(z(s.align),"cursor-text hover:bg-blue-100 dark:hover:bg-blue-800",o.className),style:O,onClick:i=>{i.stopPropagation(),setTimeout(()=>{Te(e.id,s.accessorKey,b)},0)},children:B},String(s.accessorKey)):r.jsx(f.TableCell,{className:w.cn(z(s.align),o.className),style:O,children:B},String(s.accessorKey))})]}),c&&d&&r.jsx(f.TableRow,{className:"bg-white dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800/50",children:r.jsx(f.TableCell,{colSpan:le,className:"p-4",children:c.expandedRowRender(e)})})]},e.id)})})]});return S?r.jsx(D.DndContext,{sensors:Ee,collisionDetection:D.closestCenter,onDragEnd:$e,children:he}):he}exports.DataTable=Ye;
//# sourceMappingURL=data-table.cjs.map
