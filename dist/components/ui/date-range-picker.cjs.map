{"version":3,"file":"date-range-picker.cjs","sources":["../../../src/components/ui/date-range-picker.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport { format, parse, isValid } from \"date-fns\";\nimport type { DateRange } from \"react-day-picker\";\n\nimport { cn } from \"@/lib/utils\";\nimport { InputField, type InputSize } from \"@/components/ui/input\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { CalendarIcon } from \"@/icons\";\n\nexport interface DateRangePickerProps {\n  /** 선택된 날짜 범위 */\n  value?: DateRange;\n  /** 날짜 범위 변경 핸들러 */\n  onChange?: (range: DateRange | undefined) => void;\n  /** 라벨 텍스트 */\n  label?: string;\n  /** placeholder 텍스트 */\n  placeholder?: string;\n  /** 날짜 포맷 (기본: yyyy-MM-dd) */\n  dateFormat?: string;\n  /** 에러 상태 */\n  error?: boolean;\n  /** 에러 메시지 */\n  errorMessage?: string;\n  /** 너비 크기 */\n  size?: InputSize;\n  /** 비활성화 */\n  disabled?: boolean;\n  /** 추가 className */\n  className?: string;\n  /** 라벨이 없어도 라벨 공간 유지 */\n  reserveLabelSpace?: boolean;\n}\n\nconst DateRangePicker = ({\n  value,\n  onChange,\n  label,\n  placeholder = \"yyyy-mm-dd - yyyy-mm-dd\",\n  dateFormat = \"yyyy-MM-dd\",\n  error,\n  errorMessage,\n  size = \"lg\",\n  disabled,\n  className,\n  reserveLabelSpace,\n}: DateRangePickerProps) => {\n  const [open, setOpen] = React.useState(false);\n  // 클릭 횟수 추적 (0: 미선택, 1: 첫번째 선택, 2: 완료)\n  const clickCountRef = React.useRef(0);\n  // 캘린더 내부 선택 상태\n  const [internalRange, setInternalRange] = React.useState<DateRange | undefined>(value);\n\n  // value prop 변경 시 동기화 (팝오버 닫혀있을 때만)\n  React.useEffect(() => {\n    if (!open) {\n      setInternalRange(value);\n    }\n  }, [value, open]);\n\n  // 캘린더 표시 월 상태\n  const [month, setMonth] = React.useState<Date>(new Date());\n\n  // 표시용 문자열 생성\n  const formatRange = (range: DateRange | undefined): string => {\n    if (!range) return \"\";\n    const from = range.from ? format(range.from, dateFormat) : \"\";\n    const to = range.to ? format(range.to, dateFormat) : \"\";\n    if (from && to) return `${from} - ${to}`;\n    if (from) return `${from} - `;\n    return \"\";\n  };\n\n  const [inputValue, setInputValue] = React.useState(formatRange(value));\n\n  // value prop이 변경되면 동기화\n  React.useEffect(() => {\n    setInputValue(formatRange(value));\n  }, [value, dateFormat]);\n\n  // 직접 입력 처리\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setInputValue(newValue);\n\n    // \"yyyy-MM-dd - yyyy-MM-dd\" 형식 파싱 시도\n    const parts = newValue.split(\" - \");\n    if (parts.length === 2) {\n      const from = parse(parts[0].trim(), dateFormat, new Date());\n      const to = parse(parts[1].trim(), dateFormat, new Date());\n      if (isValid(from) && isValid(to)) {\n        onChange?.({ from, to });\n      }\n    }\n  };\n\n  // 입력 완료 시 유효성 검사\n  const handleInputBlur = () => {\n    if (!inputValue) {\n      onChange?.(undefined);\n      return;\n    }\n\n    const parts = inputValue.split(\" - \");\n    if (parts.length === 2) {\n      const from = parse(parts[0].trim(), dateFormat, new Date());\n      const to = parse(parts[1].trim(), dateFormat, new Date());\n      if (isValid(from) && isValid(to)) {\n        setInputValue(`${format(from, dateFormat)} - ${format(to, dateFormat)}`);\n        onChange?.({ from, to });\n        return;\n      }\n    }\n\n    // 유효하지 않으면 이전 값으로 복원\n    setInputValue(formatRange(value));\n  };\n\n  // 캘린더에서 날짜 클릭 (onDayClick으로 실제 클릭한 날짜 사용)\n  const handleDayClick = (clickedDate: Date) => {\n    clickCountRef.current += 1;\n\n    if (clickCountRef.current === 1) {\n      // 첫 번째 클릭: 클릭한 날짜를 시작일로 설정\n      const newRange = { from: clickedDate, to: undefined };\n      setInternalRange(newRange);\n      setInputValue(formatRange(newRange));\n      onChange?.(newRange);\n    } else {\n      // 두 번째 클릭: 종료일 설정, 팝오버 닫기\n      const firstDate = internalRange?.from || clickedDate;\n      const secondDate = clickedDate;\n\n      // 빠른 날짜를 from, 늦은 날짜를 to로 정렬\n      const finalRange =\n        firstDate.getTime() <= secondDate.getTime()\n          ? { from: firstDate, to: secondDate }\n          : { from: secondDate, to: firstDate };\n\n      setInternalRange(finalRange);\n      setInputValue(formatRange(finalRange));\n      onChange?.(finalRange);\n      clickCountRef.current = 0;\n      setOpen(false);\n    }\n  };\n\n  // 팝오버 열림/닫힘 처리\n  const handleOpenChange = (isOpen: boolean) => {\n    if (isOpen) {\n      setOpen(true);\n      clickCountRef.current = 0; // 새로운 선택 시작\n      setInternalRange(value); // 기존 선택 표시 (첫 클릭 시 초기화됨)\n      // 선택된 날짜가 있으면 해당 월로 캘린더 이동\n      if (value?.from) {\n        setMonth(value.from);\n      } else {\n        setMonth(new Date());\n      }\n    } else {\n      // 선택 중이 아닐 때만 닫기 (외부 클릭 또는 ESC)\n      if (clickCountRef.current === 0) {\n        setOpen(false);\n      }\n    }\n  };\n\n  return (\n    <Popover open={open} onOpenChange={handleOpenChange}>\n      <PopoverTrigger asChild disabled={disabled}>\n        <div role=\"combobox\" aria-haspopup=\"dialog\" className={cn(\"inline-block\", className)}>\n          <InputField\n            label={label}\n            value={inputValue}\n            onChange={handleInputChange}\n            onBlur={handleInputBlur}\n            placeholder={placeholder}\n            error={error}\n            errorMessage={errorMessage}\n            size={size}\n            disabled={disabled}\n            autoComplete=\"off\"\n            rightIcon={<CalendarIcon size={24} />}\n            onRightIconClick={() => !disabled && setOpen(true)}\n            reserveLabelSpace={reserveLabelSpace}\n          />\n        </div>\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"w-auto border-0 bg-transparent p-0 shadow-none\"\n        align=\"start\"\n        onPointerDownOutside={(e) => {\n          // 선택 중일 때는 외부 클릭으로 닫히지 않도록 방지\n          if (clickCountRef.current > 0) {\n            e.preventDefault();\n          }\n        }}\n        onInteractOutside={(e) => {\n          // 선택 중일 때는 외부 클릭으로 닫히지 않도록 방지\n          if (clickCountRef.current > 0) {\n            e.preventDefault();\n          }\n        }}\n      >\n        <Calendar\n          mode=\"range\"\n          selected={internalRange}\n          onSelect={() => {}} // controlled 모드 유지 (실제 처리는 onDayClick에서)\n          onDayClick={handleDayClick}\n          month={month}\n          onMonthChange={setMonth}\n          initialFocus\n        />\n      </PopoverContent>\n    </Popover>\n  );\n};\n\nexport { DateRangePicker };\nexport type { DateRange };\n"],"names":["DateRangePicker","value","onChange","label","placeholder","dateFormat","error","errorMessage","size","disabled","className","reserveLabelSpace","open","setOpen","React","clickCountRef","internalRange","setInternalRange","month","setMonth","formatRange","range","from","format","to","inputValue","setInputValue","handleInputChange","e","newValue","parts","parse","isValid","handleInputBlur","handleDayClick","clickedDate","newRange","firstDate","secondDate","finalRange","handleOpenChange","isOpen","jsxs","Popover","jsx","PopoverTrigger","cn","InputField","CalendarIcon","PopoverContent","Calendar"],"mappings":"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"}