{"version":3,"file":"date-range-picker.mjs","sources":["../../../src/components/ui/date-range-picker.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\nimport { format, parse, isValid } from \"date-fns\";\nimport type { DateRange } from \"react-day-picker\";\n\nimport { cn } from \"@/lib/utils\";\nimport { InputField, type InputSize } from \"@/components/ui/input\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { CalendarIcon } from \"@/icons\";\n\nexport interface DateRangePickerProps {\n  /** 선택된 날짜 범위 */\n  value?: DateRange;\n  /** 날짜 범위 변경 핸들러 */\n  onChange?: (range: DateRange | undefined) => void;\n  /** 라벨 텍스트 */\n  label?: string;\n  /** placeholder 텍스트 */\n  placeholder?: string;\n  /** 날짜 포맷 (기본: yyyy-MM-dd) */\n  dateFormat?: string;\n  /** 에러 상태 */\n  error?: boolean;\n  /** 에러 메시지 */\n  errorMessage?: string;\n  /** 너비 크기 */\n  size?: InputSize;\n  /** 비활성화 */\n  disabled?: boolean;\n  /** 추가 className */\n  className?: string;\n  /** 라벨이 없어도 라벨 공간 유지 */\n  reserveLabelSpace?: boolean;\n}\n\nconst DateRangePicker = ({\n  value,\n  onChange,\n  label,\n  placeholder = \"yyyy-mm-dd - yyyy-mm-dd\",\n  dateFormat = \"yyyy-MM-dd\",\n  error,\n  errorMessage,\n  size = \"lg\",\n  disabled,\n  className,\n  reserveLabelSpace,\n}: DateRangePickerProps) => {\n  const [open, setOpen] = React.useState(false);\n  // 클릭 횟수 추적 (0: 미선택, 1: 첫번째 선택, 2: 완료)\n  const clickCountRef = React.useRef(0);\n  // 캘린더 내부 선택 상태\n  const [internalRange, setInternalRange] = React.useState<DateRange | undefined>(value);\n\n  // value prop 변경 시 동기화 (팝오버 닫혀있을 때만)\n  React.useEffect(() => {\n    if (!open) {\n      setInternalRange(value);\n    }\n  }, [value, open]);\n\n  // 캘린더 표시 월 상태\n  const [month, setMonth] = React.useState<Date>(new Date());\n\n  // 표시용 문자열 생성\n  const formatRange = (range: DateRange | undefined): string => {\n    if (!range) return \"\";\n    const from = range.from ? format(range.from, dateFormat) : \"\";\n    const to = range.to ? format(range.to, dateFormat) : \"\";\n    if (from && to) return `${from} - ${to}`;\n    if (from) return `${from} - `;\n    return \"\";\n  };\n\n  const [inputValue, setInputValue] = React.useState(formatRange(value));\n\n  // value prop이 변경되면 동기화\n  React.useEffect(() => {\n    setInputValue(formatRange(value));\n  }, [value, dateFormat]);\n\n  // 직접 입력 처리\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setInputValue(newValue);\n\n    // \"yyyy-MM-dd - yyyy-MM-dd\" 형식 파싱 시도\n    const parts = newValue.split(\" - \");\n    if (parts.length === 2) {\n      const from = parse(parts[0].trim(), dateFormat, new Date());\n      const to = parse(parts[1].trim(), dateFormat, new Date());\n      if (isValid(from) && isValid(to)) {\n        onChange?.({ from, to });\n      }\n    }\n  };\n\n  // 입력 완료 시 유효성 검사\n  const handleInputBlur = () => {\n    if (!inputValue) {\n      onChange?.(undefined);\n      return;\n    }\n\n    const parts = inputValue.split(\" - \");\n    if (parts.length === 2) {\n      const from = parse(parts[0].trim(), dateFormat, new Date());\n      const to = parse(parts[1].trim(), dateFormat, new Date());\n      if (isValid(from) && isValid(to)) {\n        setInputValue(`${format(from, dateFormat)} - ${format(to, dateFormat)}`);\n        onChange?.({ from, to });\n        return;\n      }\n    }\n\n    // 유효하지 않으면 이전 값으로 복원\n    setInputValue(formatRange(value));\n  };\n\n  // 캘린더에서 날짜 클릭 (onDayClick으로 실제 클릭한 날짜 사용)\n  const handleDayClick = (clickedDate: Date) => {\n    clickCountRef.current += 1;\n\n    if (clickCountRef.current === 1) {\n      // 첫 번째 클릭: 클릭한 날짜를 시작일로 설정\n      const newRange = { from: clickedDate, to: undefined };\n      setInternalRange(newRange);\n      setInputValue(formatRange(newRange));\n      onChange?.(newRange);\n    } else {\n      // 두 번째 클릭: 종료일 설정, 팝오버 닫기\n      const firstDate = internalRange?.from || clickedDate;\n      const secondDate = clickedDate;\n\n      // 빠른 날짜를 from, 늦은 날짜를 to로 정렬\n      const finalRange =\n        firstDate.getTime() <= secondDate.getTime()\n          ? { from: firstDate, to: secondDate }\n          : { from: secondDate, to: firstDate };\n\n      setInternalRange(finalRange);\n      setInputValue(formatRange(finalRange));\n      onChange?.(finalRange);\n      clickCountRef.current = 0;\n      setOpen(false);\n    }\n  };\n\n  // 팝오버 열림/닫힘 처리\n  const handleOpenChange = (isOpen: boolean) => {\n    if (isOpen) {\n      setOpen(true);\n      clickCountRef.current = 0; // 새로운 선택 시작\n      setInternalRange(value); // 기존 선택 표시 (첫 클릭 시 초기화됨)\n      // 선택된 날짜가 있으면 해당 월로 캘린더 이동\n      if (value?.from) {\n        setMonth(value.from);\n      } else {\n        setMonth(new Date());\n      }\n    } else {\n      // 선택 중이 아닐 때만 닫기 (외부 클릭 또는 ESC)\n      if (clickCountRef.current === 0) {\n        setOpen(false);\n      }\n    }\n  };\n\n  return (\n    <Popover open={open} onOpenChange={handleOpenChange}>\n      <PopoverTrigger asChild disabled={disabled}>\n        <div role=\"combobox\" aria-haspopup=\"dialog\" className={cn(\"inline-block\", className)}>\n          <InputField\n            label={label}\n            value={inputValue}\n            onChange={handleInputChange}\n            onBlur={handleInputBlur}\n            placeholder={placeholder}\n            error={error}\n            errorMessage={errorMessage}\n            size={size}\n            disabled={disabled}\n            autoComplete=\"off\"\n            rightIcon={<CalendarIcon size={24} />}\n            onRightIconClick={() => !disabled && setOpen(true)}\n            reserveLabelSpace={reserveLabelSpace}\n          />\n        </div>\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"w-auto border-0 bg-transparent p-0 shadow-none\"\n        align=\"start\"\n        onPointerDownOutside={(e) => {\n          // 선택 중일 때는 외부 클릭으로 닫히지 않도록 방지\n          if (clickCountRef.current > 0) {\n            e.preventDefault();\n          }\n        }}\n        onInteractOutside={(e) => {\n          // 선택 중일 때는 외부 클릭으로 닫히지 않도록 방지\n          if (clickCountRef.current > 0) {\n            e.preventDefault();\n          }\n        }}\n      >\n        <Calendar\n          mode=\"range\"\n          selected={internalRange}\n          onSelect={() => {}} // controlled 모드 유지 (실제 처리는 onDayClick에서)\n          onDayClick={handleDayClick}\n          month={month}\n          onMonthChange={setMonth}\n          initialFocus\n        />\n      </PopoverContent>\n    </Popover>\n  );\n};\n\nexport { DateRangePicker };\nexport type { DateRange };\n"],"names":["DateRangePicker","value","onChange","label","placeholder","dateFormat","error","errorMessage","size","disabled","className","reserveLabelSpace","open","setOpen","React","clickCountRef","internalRange","setInternalRange","month","setMonth","formatRange","range","from","format","to","inputValue","setInputValue","handleInputChange","e","newValue","parts","parse","isValid","handleInputBlur","handleDayClick","clickedDate","newRange","firstDate","secondDate","finalRange","jsxs","Popover","isOpen","jsx","PopoverTrigger","cn","InputField","CalendarIcon","PopoverContent","Calendar"],"mappings":"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"}