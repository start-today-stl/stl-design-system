{"version":3,"file":"file-upload.cjs","sources":["../../../src/components/ui/file-upload.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Input, inputSizeStyles, type InputSize } from \"./input\";\nimport { Button } from \"./button\";\nimport { UploadIcon, XIcon } from \"@/icons\";\n\nexport interface FileUploadProps {\n  /** 라벨 텍스트 */\n  label?: string;\n  /** 선택된 파일 배열 */\n  files: File[];\n  /** 파일 변경 콜백 */\n  onChange: (files: File[]) => void;\n  /** 최대 파일 개수 (기본 1) */\n  maxFiles?: number;\n  /** 최대 파일 크기 (bytes, 기본 10MB) */\n  maxSize?: number;\n  /** 허용 확장자 (예: \"image/jpg,image/jpeg,image/png\") */\n  accept?: string;\n  /** 커스텀 도움말 (없으면 자동 생성) */\n  helperText?: string;\n  /** 에러 상태 */\n  error?: boolean;\n  /** 에러 메시지 */\n  errorMessage?: string;\n  /** 너비 크기 */\n  size?: InputSize;\n  /** 비활성화 */\n  disabled?: boolean;\n  /** 필수 입력 표시 (라벨 앞에 점 표시) */\n  required?: boolean;\n  /** 추가 className */\n  className?: string;\n}\n\n/**\n * 파일 크기를 읽기 쉬운 형식으로 변환\n */\nconst formatFileSize = (bytes: number): string => {\n  if (bytes === 0) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))}${sizes[i]}`;\n};\n\n/**\n * accept 문자열에서 확장자 추출\n */\nconst getExtensionsFromAccept = (accept: string): string => {\n  return accept\n    .split(\",\")\n    .map((type) => {\n      const ext = type.trim().split(\"/\")[1];\n      return ext || type;\n    })\n    .join(\", \");\n};\n\nconst FileUpload = React.forwardRef<HTMLDivElement, FileUploadProps>(\n  (\n    {\n      label,\n      files,\n      onChange,\n      maxFiles = 1,\n      maxSize = 10 * 1024 * 1024, // 10MB\n      accept = \"image/*\",\n      helperText,\n      error,\n      errorMessage,\n      size = \"full\",\n      disabled,\n      required,\n      className,\n    },\n    ref\n  ) => {\n    const inputRef = React.useRef<HTMLInputElement>(null);\n\n    // 파일 선택 버튼 클릭\n    const handleButtonClick = () => {\n      if (!disabled) {\n        inputRef.current?.click();\n      }\n    };\n\n    // 파일 선택 처리\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      const selectedFiles = Array.from(e.target.files || []);\n      if (selectedFiles.length === 0) return;\n\n      // 파일 크기 필터링\n      const validFiles = selectedFiles.filter((file) => file.size <= maxSize);\n\n      if (validFiles.length > 0) {\n        if (maxFiles === 1) {\n          // 단일 파일: 교체\n          onChange([validFiles[0]]);\n        } else {\n          // 다중 파일: 추가 (최대 개수 제한)\n          const remainingSlots = maxFiles - files.length;\n          const filesToAdd = validFiles.slice(0, remainingSlots);\n          onChange([...files, ...filesToAdd]);\n        }\n      }\n\n      // input 초기화 (같은 파일 재선택 가능하도록)\n      e.target.value = \"\";\n    };\n\n    // 파일 삭제\n    const handleRemoveFile = (index: number) => {\n      const newFiles = files.filter((_, i) => i !== index);\n      onChange(newFiles);\n    };\n\n    // 자동 생성 도움말\n    const generatedHelperText = React.useMemo(() => {\n      if (helperText) return helperText;\n\n      const lines: string[] = [];\n      lines.push(`*파일 크기 ${formatFileSize(maxSize)} 이하`);\n      if (accept && accept !== \"*\") {\n        lines.push(`*업로드 가능한 확장자 : ${getExtensionsFromAccept(accept)}`);\n      }\n      return lines.join(\"\\n\");\n    }, [helperText, maxSize, accept]);\n\n    // 파일 추가 가능 여부 (단일 파일일 때는 교체 가능)\n    const canAddMore = maxFiles === 1 || files.length < maxFiles;\n\n    // 인풋에 표시할 텍스트\n    const inputDisplayText =\n      maxFiles === 1 && files.length > 0 ? files[0].name : \"\";\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\"flex flex-col gap-2\", inputSizeStyles[size], className)}\n      >\n        {/* 라벨 */}\n        {label && (\n          <label className=\"flex items-center gap-1 text-xs text-slate-600 dark:text-slate-50\">\n            {required && (\n              <span className=\"size-2 rounded-full bg-stone-400\" aria-hidden=\"true\" />\n            )}\n            {label}\n          </label>\n        )}\n\n        {/* 인풋 + 버튼 */}\n        <div\n          className={cn(\n            \"flex\",\n            \"[&>*:first-child]:rounded-r-none\",\n            \"[&>*:last-child]:rounded-l-none\",\n            \"[&>*:not(:first-child):not(:last-child)]:rounded-none\",\n            \"[&>*:not(:last-child)]:border-r-0\"\n          )}\n        >\n          <Input\n            value={inputDisplayText}\n            placeholder=\"\"\n            readOnly\n            disabled={disabled}\n            error={error}\n            className=\"flex-1\"\n            aria-label={label || \"선택된 파일\"}\n          />\n          <Button\n            type=\"button\"\n            variant=\"primary\"\n            size=\"default\"\n            onClick={handleButtonClick}\n            disabled={disabled || !canAddMore}\n          >\n            <UploadIcon size={20} />\n            파일 선택\n          </Button>\n        </div>\n\n        {/* 숨겨진 파일 인풋 */}\n        <input\n          ref={inputRef}\n          type=\"file\"\n          accept={accept}\n          multiple={maxFiles > 1}\n          onChange={handleFileChange}\n          className=\"hidden\"\n          disabled={disabled}\n          aria-label={label || \"파일 선택\"}\n        />\n\n        {/* 에러 메시지 */}\n        {error && errorMessage && (\n          <span className=\"text-xs text-destructive dark:text-red-400\">\n            {errorMessage}\n          </span>\n        )}\n\n        {/* 도움말 */}\n        {generatedHelperText && (\n          <div className=\"text-xs text-slate-500 dark:text-slate-400 whitespace-pre-line leading-5\">\n            {generatedHelperText}\n          </div>\n        )}\n\n        {/* 파일 리스트 (다중 파일일 때) */}\n        {maxFiles > 1 && files.length > 0 && (\n          <div className=\"flex flex-col gap-1\">\n            {files.map((file, index) => (\n              <div\n                key={`${file.name}-${index}`}\n                className=\"flex items-center justify-between py-1\"\n              >\n                <span className=\"text-xs text-slate-700 dark:text-slate-300\">\n                  {index + 1}. {file.name}\n                </span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs text-slate-500 dark:text-slate-400\">\n                    [{formatFileSize(file.size)}]\n                  </span>\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveFile(index)}\n                    disabled={disabled}\n                    className=\"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 disabled:opacity-50\"\n                    aria-label={`${file.name} 삭제`}\n                  >\n                    <XIcon size={18} />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nFileUpload.displayName = \"FileUpload\";\n\nexport { FileUpload };\n"],"names":["formatFileSize","bytes","k","sizes","i","getExtensionsFromAccept","accept","type","FileUpload","React","label","files","onChange","maxFiles","maxSize","helperText","error","errorMessage","size","disabled","required","className","ref","inputRef","handleButtonClick","_a","handleFileChange","e","selectedFiles","validFiles","file","remainingSlots","filesToAdd","handleRemoveFile","index","newFiles","_","generatedHelperText","lines","canAddMore","inputDisplayText","jsxs","cn","inputSizeStyles","jsx","Input","Button","UploadIcon","XIcon"],"mappings":"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"}