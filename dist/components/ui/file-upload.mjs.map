{"version":3,"file":"file-upload.mjs","sources":["../../../src/components/ui/file-upload.tsx"],"sourcesContent":["\"use client\";\n\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Input, inputSizeStyles, type InputSize } from \"./input\";\nimport { Button } from \"./button\";\nimport { UploadIcon, XIcon } from \"@/icons\";\n\nexport interface FileUploadProps {\n  /** 라벨 텍스트 */\n  label?: string;\n  /** 선택된 파일 배열 */\n  files: File[];\n  /** 파일 변경 콜백 */\n  onChange: (files: File[]) => void;\n  /** 최대 파일 개수 (기본 1) */\n  maxFiles?: number;\n  /** 최대 파일 크기 (bytes, 기본 10MB) */\n  maxSize?: number;\n  /** 허용 확장자 (예: \"image/jpg,image/jpeg,image/png\") */\n  accept?: string;\n  /** 커스텀 도움말 (없으면 자동 생성) */\n  helperText?: string;\n  /** 에러 상태 */\n  error?: boolean;\n  /** 에러 메시지 */\n  errorMessage?: string;\n  /** 너비 크기 */\n  size?: InputSize;\n  /** 비활성화 */\n  disabled?: boolean;\n  /** 필수 입력 표시 (라벨 앞에 점 표시) */\n  required?: boolean;\n  /** 추가 className */\n  className?: string;\n}\n\n/**\n * 파일 크기를 읽기 쉬운 형식으로 변환\n */\nconst formatFileSize = (bytes: number): string => {\n  if (bytes === 0) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))}${sizes[i]}`;\n};\n\n/**\n * accept 문자열에서 확장자 추출\n */\nconst getExtensionsFromAccept = (accept: string): string => {\n  return accept\n    .split(\",\")\n    .map((type) => {\n      const ext = type.trim().split(\"/\")[1];\n      return ext || type;\n    })\n    .join(\", \");\n};\n\nconst FileUpload = React.forwardRef<HTMLDivElement, FileUploadProps>(\n  (\n    {\n      label,\n      files,\n      onChange,\n      maxFiles = 1,\n      maxSize = 10 * 1024 * 1024, // 10MB\n      accept = \"image/*\",\n      helperText,\n      error,\n      errorMessage,\n      size = \"full\",\n      disabled,\n      required,\n      className,\n    },\n    ref\n  ) => {\n    const inputRef = React.useRef<HTMLInputElement>(null);\n\n    // 파일 선택 버튼 클릭\n    const handleButtonClick = () => {\n      if (!disabled) {\n        inputRef.current?.click();\n      }\n    };\n\n    // 파일 선택 처리\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      const selectedFiles = Array.from(e.target.files || []);\n      if (selectedFiles.length === 0) return;\n\n      // 파일 크기 필터링\n      const validFiles = selectedFiles.filter((file) => file.size <= maxSize);\n\n      if (validFiles.length > 0) {\n        if (maxFiles === 1) {\n          // 단일 파일: 교체\n          onChange([validFiles[0]]);\n        } else {\n          // 다중 파일: 추가 (최대 개수 제한)\n          const remainingSlots = maxFiles - files.length;\n          const filesToAdd = validFiles.slice(0, remainingSlots);\n          onChange([...files, ...filesToAdd]);\n        }\n      }\n\n      // input 초기화 (같은 파일 재선택 가능하도록)\n      e.target.value = \"\";\n    };\n\n    // 파일 삭제\n    const handleRemoveFile = (index: number) => {\n      const newFiles = files.filter((_, i) => i !== index);\n      onChange(newFiles);\n    };\n\n    // 자동 생성 도움말\n    const generatedHelperText = React.useMemo(() => {\n      if (helperText) return helperText;\n\n      const lines: string[] = [];\n      lines.push(`*파일 크기 ${formatFileSize(maxSize)} 이하`);\n      if (accept && accept !== \"*\") {\n        lines.push(`*업로드 가능한 확장자 : ${getExtensionsFromAccept(accept)}`);\n      }\n      return lines.join(\"\\n\");\n    }, [helperText, maxSize, accept]);\n\n    // 파일 추가 가능 여부 (단일 파일일 때는 교체 가능)\n    const canAddMore = maxFiles === 1 || files.length < maxFiles;\n\n    // 인풋에 표시할 텍스트\n    const inputDisplayText =\n      maxFiles === 1 && files.length > 0 ? files[0].name : \"\";\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\"flex flex-col gap-2\", inputSizeStyles[size], className)}\n      >\n        {/* 라벨 */}\n        {label && (\n          <label className=\"flex items-center gap-1 text-xs text-slate-600 dark:text-slate-50\">\n            {required && (\n              <span className=\"size-2 rounded-full bg-stone-400\" aria-hidden=\"true\" />\n            )}\n            {label}\n          </label>\n        )}\n\n        {/* 인풋 + 버튼 */}\n        <div\n          className={cn(\n            \"flex\",\n            \"[&>*:first-child]:rounded-r-none\",\n            \"[&>*:last-child]:rounded-l-none\",\n            \"[&>*:not(:first-child):not(:last-child)]:rounded-none\",\n            \"[&>*:not(:last-child)]:border-r-0\"\n          )}\n        >\n          <Input\n            value={inputDisplayText}\n            placeholder=\"\"\n            readOnly\n            disabled={disabled}\n            error={error}\n            className=\"flex-1\"\n            aria-label={label || \"선택된 파일\"}\n          />\n          <Button\n            type=\"button\"\n            variant=\"primary\"\n            size=\"default\"\n            onClick={handleButtonClick}\n            disabled={disabled || !canAddMore}\n          >\n            <UploadIcon size={20} />\n            파일 선택\n          </Button>\n        </div>\n\n        {/* 숨겨진 파일 인풋 */}\n        <input\n          ref={inputRef}\n          type=\"file\"\n          accept={accept}\n          multiple={maxFiles > 1}\n          onChange={handleFileChange}\n          className=\"hidden\"\n          disabled={disabled}\n          aria-label={label || \"파일 선택\"}\n        />\n\n        {/* 에러 메시지 */}\n        {error && errorMessage && (\n          <span className=\"text-xs text-destructive dark:text-red-400\">\n            {errorMessage}\n          </span>\n        )}\n\n        {/* 도움말 */}\n        {generatedHelperText && (\n          <div className=\"text-xs text-slate-500 dark:text-slate-400 whitespace-pre-line leading-5\">\n            {generatedHelperText}\n          </div>\n        )}\n\n        {/* 파일 리스트 (다중 파일일 때) */}\n        {maxFiles > 1 && files.length > 0 && (\n          <div className=\"flex flex-col gap-1\">\n            {files.map((file, index) => (\n              <div\n                key={`${file.name}-${index}`}\n                className=\"flex items-center justify-between py-1\"\n              >\n                <span className=\"text-xs text-slate-700 dark:text-slate-300\">\n                  {index + 1}. {file.name}\n                </span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs text-slate-500 dark:text-slate-400\">\n                    [{formatFileSize(file.size)}]\n                  </span>\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveFile(index)}\n                    disabled={disabled}\n                    className=\"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 disabled:opacity-50\"\n                    aria-label={`${file.name} 삭제`}\n                  >\n                    <XIcon size={18} />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nFileUpload.displayName = \"FileUpload\";\n\nexport { FileUpload };\n"],"names":["formatFileSize","bytes","k","sizes","i","getExtensionsFromAccept","accept","type","FileUpload","React","label","files","onChange","maxFiles","maxSize","helperText","error","errorMessage","size","disabled","required","className","ref","inputRef","handleButtonClick","_a","handleFileChange","selectedFiles","validFiles","file","remainingSlots","filesToAdd","handleRemoveFile","index","newFiles","_","generatedHelperText","lines","canAddMore","inputDisplayText","jsxs","cn","inputSizeStyles","jsx","Input","Button","UploadIcon","XIcon"],"mappings":"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"}