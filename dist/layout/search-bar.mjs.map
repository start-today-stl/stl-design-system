{"version":3,"file":"search-bar.mjs","sources":["../../src/layout/search-bar.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { createPortal } from \"react-dom\"\n\nimport { cn } from \"@/lib/utils\"\nimport { SearchIcon, STLArrowIcon } from \"@/icons\"\n\nexport interface SearchHistoryItem {\n  id: string\n  text: string\n}\n\nexport interface SearchBarProps {\n  /** 플레이스홀더 텍스트 */\n  placeholder?: string\n  /** 검색어 */\n  value?: string\n  /** 검색어 변경 핸들러 */\n  onChange?: (value: string) => void\n  /** 검색 실행 핸들러 (Enter 키) */\n  onSearch?: (value: string) => void\n  /** 최근 검색어 목록 */\n  recentSearches?: SearchHistoryItem[]\n  /** 최근 검색어 클릭 핸들러 */\n  onRecentSearchClick?: (item: SearchHistoryItem) => void\n  /** 추가 className */\n  className?: string\n  /** 비활성화 */\n  disabled?: boolean\n}\n\nconst SearchBar = React.forwardRef<HTMLInputElement, SearchBarProps>(\n  (\n    {\n      placeholder = \"검색어를 입력하세요\",\n      value,\n      onChange,\n      onSearch,\n      recentSearches = [],\n      onRecentSearchClick,\n      className,\n      disabled,\n    },\n    ref\n  ) => {\n    const [open, setOpen] = React.useState(false)\n    const [internalValue, setInternalValue] = React.useState(\"\")\n    const [highlightedIndex, setHighlightedIndex] = React.useState(-1)\n    const [dropdownPosition, setDropdownPosition] = React.useState({ top: 0, left: 0, width: 0 })\n    const containerRef = React.useRef<HTMLDivElement>(null)\n    const inputWrapperRef = React.useRef<HTMLDivElement>(null)\n    const dropdownRef = React.useRef<HTMLDivElement>(null)\n\n    const searchValue = value !== undefined ? value : internalValue\n\n    const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      const newValue = e.target.value\n      if (value === undefined) {\n        setInternalValue(newValue)\n      }\n      onChange?.(newValue)\n      setHighlightedIndex(-1)\n    }\n\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      const itemCount = recentSearches.length\n\n      if (e.key === \"ArrowDown\") {\n        e.preventDefault()\n        if (!open && itemCount > 0) {\n          setOpen(true)\n          setHighlightedIndex(0)\n        } else if (open && itemCount > 0) {\n          setHighlightedIndex((prev) => (prev + 1) % itemCount)\n        }\n      }\n\n      if (e.key === \"ArrowUp\") {\n        e.preventDefault()\n        if (open && itemCount > 0) {\n          setHighlightedIndex((prev) => (prev - 1 + itemCount) % itemCount)\n        }\n      }\n\n      if (e.key === \"Enter\") {\n        if (open && highlightedIndex >= 0 && recentSearches[highlightedIndex]) {\n          handleRecentClick(recentSearches[highlightedIndex])\n        } else {\n          onSearch?.(searchValue)\n          setOpen(false)\n        }\n      }\n\n      if (e.key === \"Escape\") {\n        setOpen(false)\n        setHighlightedIndex(-1)\n      }\n    }\n\n    const handleRecentClick = (item: SearchHistoryItem) => {\n      if (value === undefined) {\n        setInternalValue(item.text)\n      }\n      onChange?.(item.text)\n      onRecentSearchClick?.(item)\n      setOpen(false)\n      setHighlightedIndex(-1)\n    }\n\n    // 드롭다운 위치 계산\n    React.useEffect(() => {\n      if (open && inputWrapperRef.current) {\n        const rect = inputWrapperRef.current.getBoundingClientRect()\n        setDropdownPosition({\n          top: rect.bottom + 13,\n          left: rect.left,\n          width: rect.width,\n        })\n      }\n    }, [open])\n\n    // 외부 클릭 감지\n    React.useEffect(() => {\n      const handleClickOutside = (e: MouseEvent) => {\n        const target = e.target as Node\n        const isInsideContainer = containerRef.current?.contains(target)\n        const isInsideDropdown = dropdownRef.current?.contains(target)\n\n        if (!isInsideContainer && !isInsideDropdown) {\n          setOpen(false)\n          setHighlightedIndex(-1)\n        }\n      }\n\n      if (open) {\n        document.addEventListener(\"mousedown\", handleClickOutside)\n      }\n\n      return () => {\n        document.removeEventListener(\"mousedown\", handleClickOutside)\n      }\n    }, [open])\n\n    const showDropdown = open && recentSearches.length > 0\n\n    return (\n      <>\n        <div ref={containerRef} className=\"relative\">\n          <div\n            ref={inputWrapperRef}\n            className={cn(\n              \"relative flex h-9 items-center gap-2 rounded-[20px] border\",\n              \"bg-white dark:bg-slate-800\",\n              \"border-slate-100 dark:border-slate-600\",\n              \"px-3 cursor-text\",\n              \"focus-within:border-slate-500 dark:focus-within:border-slate-100\",\n              \"transition-colors\",\n              disabled && \"opacity-50 cursor-not-allowed\",\n              className\n            )}\n          >\n            <SearchIcon size={20} className=\"text-slate-500 dark:text-slate-50 shrink-0\" />\n            <input\n              ref={ref}\n              type=\"text\"\n              value={searchValue}\n              onChange={handleChange}\n              onKeyDown={handleKeyDown}\n              onFocus={() => !disabled && setOpen(true)}\n              placeholder={placeholder}\n              disabled={disabled}\n              className={cn(\n                \"flex-1 bg-transparent text-xs outline-none\",\n                \"text-slate-900 dark:text-slate-50\",\n                \"placeholder:text-slate-300 dark:placeholder:text-slate-50\",\n                \"disabled:cursor-not-allowed\"\n              )}\n            />\n            <STLArrowIcon size={24} className=\"text-blue-500 dark:text-slate-50 shrink-0\" />\n          </div>\n        </div>\n\n        {showDropdown && createPortal(\n          <div\n            ref={dropdownRef}\n            style={{\n              position: \"fixed\",\n              top: dropdownPosition.top,\n              left: dropdownPosition.left,\n              width: dropdownPosition.width,\n            }}\n            className={cn(\n              \"z-50\",\n              \"overflow-hidden rounded-[5px] border\",\n              \"border-slate-100 dark:border-slate-600\",\n              \"bg-white/90 dark:bg-slate-800/90 backdrop-blur-[12px]\",\n              \"shadow-[10px_10px_10px_0px_rgba(0,0,0,0.05)]\",\n              \"p-[5px]\",\n              \"animate-in fade-in-0 zoom-in-95 slide-in-from-top-2\"\n            )}\n          >\n            {recentSearches.map((item, index) => (\n              <button\n                key={item.id}\n                type=\"button\"\n                onClick={() => handleRecentClick(item)}\n                onMouseEnter={() => setHighlightedIndex(index)}\n                className={cn(\n                  \"flex h-[29px] w-full cursor-pointer select-none items-center rounded-[2px] px-[5px] py-[5px]\",\n                  \"text-xs text-slate-500 dark:text-slate-300 text-left\",\n                  \"hover:bg-slate-100 dark:hover:bg-slate-700\",\n                  \"focus:bg-slate-100 dark:focus:bg-slate-700 outline-none\",\n                  \"transition-colors\",\n                  highlightedIndex === index && \"bg-slate-100 dark:bg-slate-700\"\n                )}\n              >\n                {item.text}\n              </button>\n            ))}\n          </div>,\n          document.body\n        )}\n      </>\n    )\n  }\n)\nSearchBar.displayName = \"SearchBar\"\n\nexport { SearchBar }\n"],"names":["SearchBar","React","placeholder","value","onChange","onSearch","recentSearches","onRecentSearchClick","className","disabled","ref","open","setOpen","internalValue","setInternalValue","highlightedIndex","setHighlightedIndex","dropdownPosition","setDropdownPosition","containerRef","inputWrapperRef","dropdownRef","searchValue","handleChange","e","newValue","handleKeyDown","itemCount","prev","handleRecentClick","item","rect","handleClickOutside","target","isInsideContainer","_a","isInsideDropdown","_b","showDropdown","jsxs","Fragment","jsx","cn","SearchIcon","STLArrowIcon","createPortal","index"],"mappings":"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"}